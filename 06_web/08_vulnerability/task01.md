# 課題01

## 代表的な攻撃

### XSS

- 仕組み  
  入力した値をそのまま出力するWEBサイトに対して、  
  悪意のあるスクリプトをWebサイトに埋め込み、  
  ユーザーがそのスクリプトを実行することで、Cookieやセッション情報を盗み出す  
- 被害  
  - 偽のページを表示される
  - Cookieやセッション情報を抜き取られる  
  - 任意のCookieをユーザーに送られる
- 対策  
  入力値をエスケープ, サニタイズする  
  CookieのHttpOnly属性を設定する
- 参考  
  <https://www.ipa.go.jp/security/vuln/websecurity/cross-site-scripting.html>  
  <https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html>  

### コマンドインジェクション

- 仕組み  
  入力値を使ってコマンドを実行するWEBサイトに対して、  
  悪意のあるコマンドを実行させる  
- 被害  
  - サーバー内に不正のプログラムをダウンロード, 実行される
  - サーバー内のファイルを閲覧, 改ざん, 削除される
  - OSのコマンドが実行される
    - サーバーのシャットダウン, ユーザーアカウントの追加
  - 別システムへの攻撃(DDOS)に利用される
- 対策  
  引数となりえる全ての変数をチェックする  
  あらかじめ許可した処理のみを実行する
- 参考  
  <https://www.ipa.go.jp/security/vuln/websecurity/os-command.html>

### SQLインジェクション

- 仕組み  
  ユーザーが入力した値を使ってSQLを実行する処理を利用して、悪意のあるSQLを実行させる
- 被害  
  データベースにあるデータに対して、取得, 改ざん, 削除できる
  データベースに過負荷を与え、サービスを停止させる
- 対策  
  プレイスホルダーを用いてSQLを組み立てる  
  入力値をエスケープする  
- 参考  
  <https://www.ipa.go.jp/security/vuln/websecurity/sql.html>

### CSRF

- 仕組み  
  1. ユーザーがWebサイトAにログインする
  1. 攻撃者が外部サイトBを用意する  
    WebサイトAへ悪意のあるリクエストを送信するリンクを設定する
  1. ユーザーが外部サイトBを開き、リンクを踏む
  1. WebサイトAに悪意のあるリクエストが送信され、意図しない操作が行われる  
- 被害  
  - ログインユーザーが実行可能なサービスの悪用
    - 不正な送金
    - 商品の購入
    - 退会処理
  - ログインユーザーによる情報の改ざん  
    - パスワードの変更
    - 掲示板への投稿
- 対策  
  - CSRF検証用トークンを発行する  
    都度ランダムな値を生成し、前画面のhiddenパラメータに設定  
    リクエストにそのトークンを含めて送信する (Cookieには含めない)  
    セッションIDとトークンの値を検証し一致する場合のみ処理を行う
  - SameSiteを設定する
- 参考  
  <https://www.ipa.go.jp/security/vuln/websecurity/csrf.html>  
  <https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html>  
  <https://learn.microsoft.com/ja-jp/aspnet/web-api/overview/security/preventing-cross-site-request-forgery-csrf-attacks>  
  <https://blog.tokumaru.org/2022/01/impact-conditions-for-no-CSRF-protection-sites.html>  
  <https://zenn.dev/yktakaha4/articles/study_csrf_attack>  

## 正規表現エンジン

Regular expression Denial of Service (ReDoS)  
ReDosという攻撃を受けサービスが停止する恐れがある。  

- 例  
  正規表現: `^(a+)+$` で検証する場合、  
  `aaaaX`は16パターン, `aaaaaaaaaaaaaaaaX`は65536パターンの検証が行われる。  
- 対策  
  - 入力値の文字数を制限する
  - 検証処理にタイムアウトを設定する
- 参考
  <https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS>  
  <https://learn.microsoft.com/ja-jp/dotnet/standard/base-types/backtracking-in-regular-expressions>  
